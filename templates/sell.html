{% extends "layout.html" %}

{% block title %}
    sell
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}


{% block main %}
  <!-- Message block at the top -->
  {% if message %}
    <div class="container mt-3">
      <div class="alert alert-{{category}} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    </div>
  {% endif %}

  <!-- rest of code -->
 <form  method="post">
        <div class="mb-3">
            <input autocomplete="off" autofocus class="form-control mx-auto w-auto" name="name" placeholder="name" type="text">

        </div>
        <button class="btn btn-primary" type="submit"> submit </button>
    </form>


  {% if stock is not none %}



<div class="container mt-4" style = "font-size:15px;">
  <h2>Shares detail</h2>
  <table class="table table-bordered table-hover table-striped">
<tbody>
    <tr>

        <td>{{stock["name"]}}</td>
    </tr>
    <tr>

        <td>{{stock["symbol"]}}</td>
    </tr>
    <tr>

        <td> ${{stock["price"]}}</td>
    </tr>
      <tr>

        <td>
            <button value = "{{stock['price']}}"type = "button" id = "button"> convert to INR</button>
        </td>
    </tr>

</tbody>
</table>
</div>


            <form method = "post">
              <div class = "mb-3">
                <input   type = "number" name = "number"  set = "1" required>
                <button class = "btn btn-primary" type= "submit"> sell</button>
              </div>

            </form>
  {% endif %}


<script>
  // wait 3 seconds, then fade out & remove the alert
  setTimeout(function () {
    let alert = document.querySelector(".alert");
    if (alert) {
      // fade out smoothly
      alert.classList.remove("show");
      // remove completely after fade animation
      setTimeout(() => alert.remove(), 1000);
    }
  }, 3000);  // 3000 ms = 3 seconds


        //convert to inr
      document.addEventListener('DOMContentLoaded',() => {

        const button = document.querySelector('#button');

        button.onclick = () => {
                fetch('https://api.frankfurter.app/latest?from=USD')
                .then(response => response.json())
                .then(data => {

                 let td = button.parentElement;
                 td.innerHTML =' &#8377;' + (parseFloat(button.value)*data.rates.INR).toFixed(2);

                return false;
                })
                }
    })
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
